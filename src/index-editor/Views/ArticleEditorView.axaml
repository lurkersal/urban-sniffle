<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:IndexEditor.Views"
             x:Class="IndexEditor.Views.ArticleEditorView">
    <UserControl.Resources>
        <local:CategoryToBrushConverter x:Key="CategoryToBrush"/>
        <local:CategoryDisplayModeMatchesConverter x:Key="CategoryModeMatches" />
        <local:ShowPhotographerCategoryConverter x:Key="ShowPhotographer" />
        <local:FieldLabelConverter x:Key="FieldLabelConverter" />
        <local:ShowMeasurementsConverter x:Key="ShowMeasurements" />
        <local:ShowContributorCategoryConverter x:Key="ShowContributor" />
    </UserControl.Resources>
    <Grid>
        <StackPanel Margin="16">
            <!-- Single Article Card for Editing -->
            <Border Background="{Binding SelectedArticle.Category, Converter={StaticResource CategoryToBrush}}" CornerRadius="4" Padding="16" Margin="0,0,0,16">
                <StackPanel Orientation="Vertical" Spacing="6">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Category:" FontWeight="Bold" Width="120"/>
                        <ComboBox Name="CategoryComboBox" SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                                  ItemsSource="{Binding DataContext.Categories, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  Width="240"/>
                        <TextBlock Text="Loading categories..." Foreground="Gray" FontSize="12" Margin="12,0,0,0"
                                   IsVisible="{Binding DataContext.IsLoadingCategories, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" IsVisible="{Binding SelectedArticle.Category, Converter={StaticResource CategoryModeMatches}, ConverterParameter='1,2,3'}">
                        <TextBlock Text="Title:" FontWeight="Bold" Width="120"/>
                        <TextBox Name="TitleTextBox" Text="{Binding SelectedArticle.Title, Mode=TwoWay}" Width="240"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" IsVisible="{Binding SelectedArticle.Category, Converter={StaticResource CategoryModeMatches}, ConverterParameter='2'}">
                        <TextBlock Text="Model:" FontWeight="Bold" Width="120"/>
                        <TextBox Text="{Binding SelectedArticle.ModelNames[0], Mode=TwoWay}" Width="240"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" IsVisible="{Binding SelectedArticle.Category, Converter={StaticResource CategoryModeMatches}, ConverterParameter='2'}">
                        <TextBlock Text="Age:" FontWeight="Bold" Width="120"/>
                        <TextBox Text="{Binding SelectedArticle.Ages[0], Mode=TwoWay}" Width="120"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" IsVisible="{Binding SelectedArticle, Converter={StaticResource ShowMeasurements}}">
                        <TextBlock Text="Measurements:" FontWeight="Bold" Width="120"/>
                        <TextBox Width="240">
                            <TextBox.Text>
                                <Binding Path="SelectedArticle.Measurements0" Mode="TwoWay" UpdateSourceTrigger="LostFocus" />
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>
                    <TextBlock Text="{Binding SelectedArticle.MeasurementsErrorMessage}" Foreground="Red" FontSize="12" Margin="124,2,0,0" IsVisible="{Binding SelectedArticle.HasMeasurementsError}" />
                    <TextBlock Text="Format: bust(+cup)-waist-hip â€” e.g. '36B-28-38' (separator must be '-')" Foreground="Gray" FontSize="11" Margin="124,2,0,0" IsVisible="{Binding SelectedArticle.HasMeasurementsError}" />

                    <StackPanel Orientation="Horizontal" IsVisible="{Binding SelectedArticle.Category, Converter={StaticResource ShowContributor}}">
                        <TextBlock Text="{Binding SelectedArticle.Category, Converter={StaticResource FieldLabelConverter}, ConverterParameter=Photographer}" FontWeight="Bold" Width="120"/>
                        <TextBox Text="{Binding SelectedArticle.Contributor0, Mode=TwoWay}" Width="240"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Pages:" FontWeight="Bold" Width="120"/>
                        <TextBox Text="{Binding SelectedArticle.PagesText, Mode=TwoWay}" Width="240"/>
                    </StackPanel>

                    <!-- Segments row: lozenge-shaped segment bars stacked horizontally -->
                     <StackPanel Orientation="Horizontal" Margin="0,8,0,0" IsVisible="{Binding SelectedArticle}">
                         <ItemsControl ItemsSource="{Binding SelectedArticle.Segments}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="14" Padding="8,4" Margin="0,0,8,0" MinHeight="28" Tag="{Binding}" PointerPressed="OnSegmentLozengePressed">
                                        <Grid>
                                            <!-- Base inactive background -->
                                            <Border Background="{StaticResource SegmentInactiveBackground}" CornerRadius="14" />
                                            <!-- Inner subtle highlight (top) to simulate bevel -->
                                            <Border BorderBrush="#FFFFFFAA" BorderThickness="0,1,0,0" CornerRadius="14" IsHitTestVisible="False" />
                                            <!-- Inner subtle shadow (bottom-right) to simulate bevel -->
                                            <Border BorderBrush="#0000001A" BorderThickness="0,0,1,1" CornerRadius="14" IsHitTestVisible="False" />
                                            <!-- Active overlay (category colour) shown only when segment.IsHighlighted is true -->
                                            <Border Background="{Binding DataContext.SelectedArticle.Category, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource CategoryToBrush}}" Opacity="0.6" CornerRadius="14" IsVisible="{Binding IsHighlighted}" />
                                            <TextBlock Text="{Binding Display}" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="Black" FontWeight="Normal" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </StackPanel>
            </Border>
            <!-- Page Segments and Notes removed from this view -->
            </StackPanel>
            <!-- Overlay for SegmentEditorPopover -->
            <!-- <Border Name="SegmentEditorOverlay" Background="#80000000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ZIndex="100" IsVisible="False">
                <views:SegmentEditorPopover HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border> -->
        </Grid>
    </UserControl>
