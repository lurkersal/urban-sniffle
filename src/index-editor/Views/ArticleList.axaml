<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:IndexEditor.Views"
             x:Class="IndexEditor.Views.ArticleList">
    <UserControl.Resources>
        <local:CoverModelCategoryConverter x:Key="CoverModelCategoryConverter" />
        <local:ArticleCategoryDisplayConverter x:Key="ArticleCategoryDisplayConverter" />
        <local:ArticleCategoryToColorConverter x:Key="ArticleCategoryToColorConverter" />
        <local:ArticleFieldFriendlyTextConverter x:Key="ArticleFieldFriendlyTextConverter" />
        <local:SelectedArticleBorderConverter x:Key="SelectedArticleBorderConverter" />
    </UserControl.Resources>
    <Grid RowDefinitions="Auto,*">
        <TextBlock Grid.Row="0" Text="Article List" FontWeight="Bold" FontSize="16" Margin="8,8,8,4"/>
        <ListBox x:Name="ArticlesListBox" Grid.Row="1"
                 ItemsSource="{Binding Articles}"
                 SelectedItem="{Binding SelectedArticle, Mode=TwoWay}"
                 BorderThickness="0" KeyDown="OnListKeyDown">
            <ListBox.Styles>
                <Style Selector="ListBoxItem">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Template">
                        <ControlTemplate>
                            <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        </ControlTemplate>
                    </Setter>
                </Style>
                <Style Selector="ListBoxItem:selected">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Padding" Value="0"/>
                </Style>
                <Style Selector="ListBoxItem:focused">
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
                <Style Selector="ListBoxItem:pressed">
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
            </ListBox.Styles>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border
                        Background="{Binding Category, Converter={StaticResource ArticleCategoryToColorConverter}}"
                        Margin="8,4" Padding="8" CornerRadius="4"
                        BorderBrush="{Binding IsSelected, Converter={StaticResource SelectedArticleBorderConverter}}"
                        BorderThickness="1"
                        PointerPressed="OnArticlePointerPressed"
                        Tag="{Binding}" >
                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                            <!-- Top row: Title (left, bold, large), Category (right, no label) -->
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding DisplayTitle}" FontWeight="Bold" FontSize="18" VerticalAlignment="Top"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Category}" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right" VerticalAlignment="Top"/>

                            <!-- Second row: Model info for Model/Cover only -->
                            <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" IsVisible="{Binding Category, Converter={StaticResource CoverModelCategoryConverter}}">
                                <TextBlock Text="{Binding ModelName0}" FontSize="14" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding Age0}" FontSize="14" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding Measurements[0]}" FontSize="14"/>
                            </StackPanel>

                            <!-- Third row: Photographer (left) and Pages (right, always visible) -->
                            <Grid Grid.Row="2" Grid.ColumnSpan="2">
                                <TextBlock Text="{Binding Photographer0}" FontSize="13" FontWeight="Normal" HorizontalAlignment="Left" VerticalAlignment="Bottom"/>
                                <TextBlock Text="{Binding Pages, Converter={StaticResource ArticleFieldFriendlyTextConverter}}" FontSize="13" FontWeight="Normal" HorizontalAlignment="Right" VerticalAlignment="Bottom"/>
                            </Grid>
                            <!-- Auto-highlight overlay (animated via code-behind) -->
                            <Border x:Name="AutoHighlightOverlay" Grid.RowSpan="3" Background="#80FFFF66" Opacity="0" CornerRadius="4" IsHitTestVisible="False"/>
                        </Grid>
                     </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</UserControl>
