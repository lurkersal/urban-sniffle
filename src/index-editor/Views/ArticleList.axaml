<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:IndexEditor.Views"
             x:Class="IndexEditor.Views.ArticleList">
    <UserControl.Resources>
        <!-- Segment inactive background brush used for lozenge bars -->
        <SolidColorBrush x:Key="SegmentInactiveBackground" Color="#F5F5F5" />
        <local:CoverModelCategoryConverter x:Key="CoverModelCategoryConverter" />
        <local:ArticleCategoryDisplayConverter x:Key="ArticleCategoryDisplayConverter" />
        <local:ArticleCategoryToColorConverter x:Key="ArticleCategoryToColorConverter" />
        <local:CategoryToContrastBrushConverter x:Key="CategoryToContrastBrushConverter" />
        <local:CategoryToSubtleBackgroundConverter x:Key="CategoryToSubtleBackgroundConverter" />
        <local:CategoryToAccentBrushConverter x:Key="CategoryToAccentBrushConverter" />
        <local:SegmentsToTextConverter x:Key="SegmentsToTextConverter" />
        <local:ArticleFieldFriendlyTextConverter x:Key="ArticleFieldFriendlyTextConverter" />
        <local:SelectedArticleBorderConverter x:Key="SelectedArticleBorderConverter" />
    </UserControl.Resources>
    <Grid RowDefinitions="Auto,*">
        <TextBlock Grid.Row="0" Text="Article List" FontWeight="Bold" FontSize="16" Margin="8,8,8,4"/>
        <ListBox x:Name="ArticlesListBox" Grid.Row="1"
                 ItemsSource="{Binding Articles}"
                 SelectedItem="{Binding SelectedArticle, Mode=TwoWay}"
                 BorderThickness="0" KeyDown="OnListKeyDown">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.Styles>
                <Style Selector="ListBoxItem">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Template">
                        <ControlTemplate>
                            <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        </ControlTemplate>
                    </Setter>
                </Style>
                <Style Selector="ListBoxItem:selected">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Padding" Value="0"/>
                </Style>
                <Style Selector="ListBoxItem:focused">
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
                <Style Selector="ListBoxItem:pressed">
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
            </ListBox.Styles>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border
                        Background="Transparent"
                        Margin="8,4" Padding="8" CornerRadius="4"
                        BorderBrush="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}, Converter={StaticResource SelectedArticleBorderConverter}}"
                        BorderThickness="1"
                        PointerPressed="OnArticlePointerPressed"
                        Tag="{Binding}" >
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                            <!-- Left colour indicator: narrow bar bound to the article Category -->
                            <Border Grid.Column="0" Grid.RowSpan="5" Width="16" BorderBrush="#333" BorderThickness="1" CornerRadius="2" Margin="0,0,8,0">
                                <!-- Use the category color at 60% opacity for the main article bar to match spec -->
                                <Border Background="{Binding Category, Converter={StaticResource ArticleCategoryToColorConverter}}" Opacity="0.6" CornerRadius="1" />
                            </Border>

                            <!-- Top row: Title (left, bold, large), Category (right, no label) -->
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding DisplayTitle}" FontWeight="Bold" FontSize="18" VerticalAlignment="Top"/>
                            <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding Category}" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right" VerticalAlignment="Top"/>

                            <!-- Second row: Model info for Model/Cover only -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal" IsVisible="{Binding Category, Converter={StaticResource CoverModelCategoryConverter}}">
                                <TextBlock Text="{Binding ModelName0}" FontSize="14" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding Age0}" FontSize="14" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding Measurements[0]}" FontSize="14"/>
                            </StackPanel>

                            <!-- Third row: Photographer (left) and Pages (right, always visible) -->
                            <Grid Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2">
                                <TextBlock Text="{Binding Photographer0}" FontSize="13" FontWeight="Normal" HorizontalAlignment="Left" VerticalAlignment="Bottom"/>
                            </Grid>

                            <!-- Segments list: simplified rows (transparent background) -->
                            <ItemsControl x:Name="SegmentsItems" Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2" ItemsSource="{Binding Segments}" Margin="8,8,0,0">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- Lozenge-shaped segment bar laid out horizontally -->
                                        <Border CornerRadius="12" Padding="6,4" Margin="0,0,8,0" MinHeight="24" Tag="{Binding}" PointerPressed="OnSegmentPointerPressed" BorderBrush="#CCC" BorderThickness="1">
                                            <Grid>
                                                <!-- Inactive base -->
                                                <Border Background="{StaticResource SegmentInactiveBackground}" CornerRadius="12" />
                                                <!-- Inner subtle highlight (top) to simulate bevel -->
                                                <Border BorderBrush="#FFFFFFAA" BorderThickness="0,1,0,0" CornerRadius="12" IsHitTestVisible="False" />
                                                <!-- Inner subtle shadow (bottom-right) to simulate bevel -->
                                                <Border BorderBrush="#0000001A" BorderThickness="0,0,1,1" CornerRadius="12" IsHitTestVisible="False" />
                                                <!-- Active overlay (article category color) -->
                                                <Border Background="{Binding DataContext.Category, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource ArticleCategoryToColorConverter}}"
                                                        Opacity="0.6" CornerRadius="12" IsVisible="{Binding IsHighlighted}" />
                                                <!-- Text label (black) -->
                                                <TextBlock Text="{Binding Display}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Black" FontSize="13" FontWeight="SemiBold" />
                                            </Grid>
                                         </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Auto-highlight overlay (animated via code-behind) -->
                            <Border x:Name="AutoHighlightOverlay" Grid.Column="1" Grid.RowSpan="4" Grid.ColumnSpan="2" Background="#80FFFF66" Opacity="0" CornerRadius="4" IsHitTestVisible="False"/>
                        </Grid>
                     </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</UserControl>
